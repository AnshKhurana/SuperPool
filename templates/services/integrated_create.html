{% extends 'base.html' %}
{% load static %}

{% block content %}

    <script type="text/javascript" src="{% static 'admin/js/vendor/jquery/jquery.js' %}"></script>
    {% csrf_token %}
    <section>
        <div class="gap gray-bg">
            <div class="container-fluid">
                <div class="row">
                    <div class="col-lg-12">
                        <div class="row" id="page-contents">
                            {% include 'includes/sidebar.html' %}
                            <div class="col-lg-6">
                                <div class="central-meta">
                                    <div class="frnds">
                                        {#                                        <ul class="nav nav-tabs">#}
                                        <h5 class="f-title"><i class="ti-user"></i>Food Service</h5>
                                        {#                                        </ul>#}

                                        <div class="tab-content">
                                            <div class="tab-pane active fade show " id="frends">

                                                {#                                                insert stuff here#}

                                                <h2>Enter details:</h2>
                                                <form method="POST">
                                                    {% csrf_token %}
                                                    <table>
                                                        {{ form.as_p }}
                                                        <!--                                                        {{ form.media }}-->
                                                    </table>
                                                    <br>
                                                    <button type="submit">Submit</button>
                                                    <ul class="nearby-contct"  id="service_list">



                                                        {#                                                        INSERT HERE#}

                                                    </ul>
                                                </form>




                                                <div class="lodmore">
                                                    <button class="btn-view btn-load-more"></button>
                                                </div>

                                            </div>
                                            <script>
                                                function myFunction() {
                                                    window.open("/groups/create", "popup", 'width=400,height=300, top=400, left=700');
                                                }
                                            </script>

                                        </div>
                                    </div>
                                </div>
                            </div><!-- centerl meta -->
                            <!--                            <div class="col-lg-3">-->
                            <!--                                <aside class="sidebar static">-->
                            <!--                                    <div class="widget">-->
                            <!--                                        <h4 class="widget-title">Who's follownig</h4>-->
                            <!--                                        <ul class="followers">-->
                            <!--                                            <li>-->
                            <!--                                                <figure><img src="images/resources/friend-avatar2.jpg" alt=""></figure>-->
                            <!--                                                <div class="friend-meta">-->
                            <!--                                                    <h4><a href="time-line.html" title="">Kelly Bill</a></h4>-->
                            <!--                                                    <a href="#" title="" class="underline">Add Friend</a>-->
                            <!--                                                </div>-->
                            <!--                                            </li>-->
                            <!--                                            <li>-->
                            <!--                                                <figure><img src="images/resources/friend-avatar4.jpg" alt=""></figure>-->
                            <!--                                                <div class="friend-meta">-->
                            <!--                                                    <h4><a href="time-line.html" title="">Issabel</a></h4>-->
                            <!--                                                    <a href="#" title="" class="underline">Add Friend</a>-->
                            <!--                                                </div>-->
                            <!--                                            </li>-->
                            <!--                                            <li>-->
                            <!--                                                <figure><img src="images/resources/friend-avatar6.jpg" alt=""></figure>-->
                            <!--                                                <div class="friend-meta">-->
                            <!--                                                    <h4><a href="time-line.html" title="">Andrew</a></h4>-->
                            <!--                                                    <a href="#" title="" class="underline">Add Friend</a>-->
                            <!--                                                </div>-->
                            <!--                                            </li>-->
                            <!--                                            <li>-->
                            <!--                                                <figure><img src="images/resources/friend-avatar8.jpg" alt=""></figure>-->
                            <!--                                                <div class="friend-meta">-->
                            <!--                                                    <h4><a href="time-line.html" title="">Sophia</a></h4>-->
                            <!--                                                    <a href="#" title="" class="underline">Add Friend</a>-->
                            <!--                                                </div>-->
                            <!--                                            </li>-->
                            <!--                                            <li>-->
                            <!--                                                <figure><img src="images/resources/friend-avatar3.jpg" alt=""></figure>-->
                            <!--                                                <div class="friend-meta">-->
                            <!--                                                    <h4><a href="time-line.html" title="">Allen</a></h4>-->
                            <!--                                                    <a href="#" title="" class="underline">Add Friend</a>-->
                            <!--                                                </div>-->
                            <!--                                            </li>-->
                            <!--                                        </ul>-->
                            <!--                                    </div>&lt;!&ndash; who's following &ndash;&gt;-->
                            <!--                                    <div class="widget friend-list stick-widget">-->
                            <!--                                        <h4 class="widget-title">Friends</h4>-->
                            <!--                                        <div id="searchDir"></div>-->
                            <!--                                        <ul id="people-list" class="friendz-list">-->
                            <!--                                            <li>-->
                            <!--                                                <figure>-->
                            <!--                                                    <img src="images/resources/friend-avatar.jpg" alt="">-->
                            <!--                                                    <span class="status f-online"></span>-->
                            <!--                                                </figure>-->
                            <!--                                                <div class="friendz-meta">-->
                            <!--                                                    <a href="time-line.html">bucky barnes</a>-->
                            <!--                                                    <i><a href="https://wpkixx.com/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="84f3edeaf0e1f6f7ebe8e0e1f6c4e3e9e5ede8aae7ebe9">[email&#160;protected]</a></i>-->
                            <!--                                                </div>-->
                            <!--                                            </li>-->
                            <!--                                            <li>-->
                            <!--                                                <figure>-->
                            <!--                                                    <img src="images/resources/friend-avatar2.jpg" alt="">-->
                            <!--                                                    <span class="status f-away"></span>-->
                            <!--                                                </figure>-->
                            <!--                                                <div class="friendz-meta">-->
                            <!--                                                    <a href="time-line.html">Sarah Loren</a>-->
                            <!--                                                    <i><a href="https://wpkixx.com/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="96f4f7e4f8f3e5d6f1fbf7fffab8f5f9fb">[email&#160;protected]</a></i>-->
                            <!--                                                </div>-->
                            <!--                                            </li>-->
                            <!--                                            <li>-->
                            <!--                                                <figure>-->
                            <!--                                                    <img src="images/resources/friend-avatar3.jpg" alt="">-->
                            <!--                                                    <span class="status f-off"></span>-->
                            <!--                                                </figure>-->
                            <!--                                                <div class="friendz-meta">-->
                            <!--                                                    <a href="time-line.html">jason borne</a>-->
                            <!--                                                    <i><a href="https://wpkixx.com/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="1a707b697574785a7d777b737634797577">[email&#160;protected]</a></i>-->
                            <!--                                                </div>-->
                            <!--                                            </li>-->
                            <!--                                            <li>-->
                            <!--                                                <figure>-->
                            <!--                                                    <img src="images/resources/friend-avatar4.jpg" alt="">-->
                            <!--                                                    <span class="status f-off"></span>-->
                            <!--                                                </figure>-->
                            <!--                                                <div class="friendz-meta">-->
                            <!--                                                    <a href="time-line.html">Cameron diaz</a>-->
                            <!--                                                    <i><a href="https://wpkixx.com/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="234942504c4d4163444e424a4f0d404c4e">[email&#160;protected]</a></i>-->
                            <!--                                                </div>-->
                            <!--                                            </li>-->
                            <!--                                            <li>-->

                            <!--                                                <figure>-->
                            <!--                                                    <img src="images/resources/friend-avatar5.jpg" alt="">-->
                            <!--                                                    <span class="status f-online"></span>-->
                            <!--                                                </figure>-->
                            <!--                                                <div class="friendz-meta">-->
                            <!--                                                    <a href="time-line.html">daniel warber</a>-->
                            <!--                                                    <i><a href="https://wpkixx.com/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="0c666d7f63626e4c6b616d6560226f6361">[email&#160;protected]</a></i>-->
                            <!--                                                </div>-->
                            <!--                                            </li>-->
                            <!--                                            <li>-->

                            <!--                                                <figure>-->
                            <!--                                                    <img src="images/resources/friend-avatar6.jpg" alt="">-->
                            <!--                                                    <span class="status f-away"></span>-->
                            <!--                                                </figure>-->
                            <!--                                                <div class="friendz-meta">-->
                            <!--                                                    <a href="time-line.html">andrew</a>-->
                            <!--                                                    <i><a href="https://wpkixx.com/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="89e3e8fae6e7ebc9eee4e8e0e5a7eae6e4">[email&#160;protected]</a></i>-->
                            <!--                                                </div>-->
                            <!--                                            </li>-->
                            <!--                                            <li>-->

                            <!--                                                <figure>-->
                            <!--                                                    <img src="images/resources/friend-avatar7.jpg" alt="">-->
                            <!--                                                    <span class="status f-off"></span>-->
                            <!--                                                </figure>-->
                            <!--                                                <div class="friendz-meta">-->
                            <!--                                                    <a href="time-line.html">amy watson</a>-->
                            <!--                                                    <i><a href="https://wpkixx.com/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="670d061408090527000a060e0b4904080a">[email&#160;protected]</a></i>-->
                            <!--                                                </div>-->
                            <!--                                            </li>-->
                            <!--                                            <li>-->

                            <!--                                                <figure>-->
                            <!--                                                    <img src="images/resources/friend-avatar5.jpg" alt="">-->
                            <!--                                                    <span class="status f-online"></span>-->
                            <!--                                                </figure>-->
                            <!--                                                <div class="friendz-meta">-->
                            <!--                                                    <a href="time-line.html">daniel warber</a>-->
                            <!--                                                    <i><a href="https://wpkixx.com/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="f49e95879b9a96b49399959d98da979b99">[email&#160;protected]</a></i>-->
                            <!--                                                </div>-->
                            <!--                                            </li>-->
                            <!--                                            <li>-->

                            <!--                                                <figure>-->
                            <!--                                                    <img src="images/resources/friend-avatar2.jpg" alt="">-->
                            <!--                                                    <span class="status f-away"></span>-->
                            <!--                                                </figure>-->
                            <!--                                                <div class="friendz-meta">-->
                            <!--                                                    <a href="time-line.html">Sarah Loren</a>-->
                            <!--                                                    <i><a href="https://wpkixx.com/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="583a392a363d2b183f35393134763b3735">[email&#160;protected]</a></i>-->
                            <!--                                                </div>-->
                            <!--                                            </li>-->
                            <!--                                        </ul>-->
                            <!--                                        <div class="chat-box">-->
                            <!--                                            <div class="chat-head">-->
                            <!--                                                <span class="status f-online"></span>-->
                            <!--                                                <h6>Bucky Barnes</h6>-->
                            <!--                                                <div class="more">-->
                            <!--                                                    <span><i class="ti-more-alt"></i></span>-->
                            <!--                                                    <span class="close-mesage"><i class="ti-close"></i></span>-->
                            <!--                                                </div>-->
                            <!--                                            </div>-->
                            <!--                                            <div class="chat-list">-->
                            <!--                                                <ul>-->
                            <!--                                                    <li class="me">-->
                            <!--                                                        <div class="chat-thumb"><img src="images/resources/chatlist1.jpg" alt=""></div>-->
                            <!--                                                        <div class="notification-event">-->
                            <!--															<span class="chat-message-item">-->
                            <!--																Hi James! Please remember to buy the food for tomorrow! I’m gonna be handling the gifts and Jake’s gonna get the drinks-->
                            <!--															</span>-->
                            <!--                                                            <span class="notification-date"><time datetime="2004-07-24T18:18" class="entry-date updated">Yesterday at 8:10pm</time></span>-->
                            <!--                                                        </div>-->
                            <!--                                                    </li>-->
                            <!--                                                    <li class="you">-->
                            <!--                                                        <div class="chat-thumb"><img src="images/resources/chatlist2.jpg" alt=""></div>-->
                            <!--                                                        <div class="notification-event">-->
                            <!--															<span class="chat-message-item">-->
                            <!--																Hi James! Please remember to buy the food for tomorrow! I’m gonna be handling the gifts and Jake’s gonna get the drinks-->
                            <!--															</span>-->
                            <!--                                                            <span class="notification-date"><time datetime="2004-07-24T18:18" class="entry-date updated">Yesterday at 8:10pm</time></span>-->
                            <!--                                                        </div>-->
                            <!--                                                    </li>-->
                            <!--                                                    <li class="me">-->
                            <!--                                                        <div class="chat-thumb"><img src="images/resources/chatlist1.jpg" alt=""></div>-->
                            <!--                                                        <div class="notification-event">-->
                            <!--															<span class="chat-message-item">-->
                            <!--																Hi James! Please remember to buy the food for tomorrow! I’m gonna be handling the gifts and Jake’s gonna get the drinks-->
                            <!--															</span>-->
                            <!--                                                            <span class="notification-date"><time datetime="2004-07-24T18:18" class="entry-date updated">Yesterday at 8:10pm</time></span>-->
                            <!--                                                        </div>-->
                            <!--                                                    </li>-->
                            <!--                                                </ul>-->
                            <!--                                                <form class="text-box">-->
                            <!--                                                    <textarea placeholder="Post enter to post..."></textarea>-->
                            <!--                                                    <div class="add-smiles">-->
                            <!--                                                        <span title="add icon" class="em em-expressionless"></span>-->
                            <!--                                                    </div>-->
                            <!--                                                    <div class="smiles-bunch">-->
                            <!--                                                        <i class="em em-&#45;&#45;1"></i>-->
                            <!--                                                        <i class="em em-smiley"></i>-->
                            <!--                                                        <i class="em em-anguished"></i>-->
                            <!--                                                        <i class="em em-laughing"></i>-->
                            <!--                                                        <i class="em em-angry"></i>-->
                            <!--                                                        <i class="em em-astonished"></i>-->
                            <!--                                                        <i class="em em-blush"></i>-->
                            <!--                                                        <i class="em em-disappointed"></i>-->
                            <!--                                                        <i class="em em-worried"></i>-->
                            <!--                                                        <i class="em em-kissing_heart"></i>-->
                            <!--                                                        <i class="em em-rage"></i>-->
                            <!--                                                        <i class="em em-stuck_out_tongue"></i>-->
                            <!--                                                    </div>-->
                            <!--                                                    <button type="submit"></button>-->
                            <!--                                                </form>-->
                        </div>
                    </div>
                </div><!-- friends list sidebar -->
                </aside>
            </div><!-- sidebar -->
        </div>
        </div>
        </div>
        </div>
        </div>
    </section>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script>

        document.getElementById("id_start_time").addEventListener("change",fetchServices);
        document.getElementById("id_end_time").addEventListener("change",fetchServices);
        function fetchServices()

        {
            const instance = axios.create({
                baseURL: '{% url 'pool:home' %}',
                timeout: 1000,
            });

            var start= document.getElementById("id_start_time").value;
            var end= document.getElementById("id_end_time").value;
            if (start==undefined || end==undefined || start=="" || end=="")
            {
                start= undefined;
                end= undefined;
            }

            var cat_selected = "food";
            var gids_to_choose_from = "1,2";
            var all_gids = gids_to_choose_from.split(",");
            var selected_gids = all_gids;
            var select = document.getElementById("service_list");
            select.innerHTML = "";

            {#for (gid in all_gids)#}
            {#{#}
            {#    var selected = document.getElementById('group_' + all_gids[gid]).checked;#}
            {#    if (selected)#}
            {#    {#}
            {#        selected_gids.push(all_gids[gid]);#}
            {#    }#}
            {#}#}

                var gid_string =selected_gids.join(",");

                if (gid_string == "")
                {
                    return;
                }
                if (cat_selected == "food")
                {
                    instance.get('/api/foodservice', {
                        params: {
                            gids: gid_string,
                            start: start,
                            end: end
                        }
                    }).then(
                        function (response) {
                            reply = response.data;
                            console.log(reply);

                            for (item in reply)
                            {
                                {#here, reply[item] is our service object, can access fields directly,#}
                                select.innerHTML += "<li> <div class=\'nearly-pepls\'> <div class=\"pepl-info\">" +
                                    "<h4><a href=\"#\" title=\"\">Food Service</a></h4>" +
                                    "<a href=\"#\" title=\"\"><h5>" + reply[item].vendor + "</h5></a>" +
                                    "<p> by " + reply[item].initiator + "</p>" +
                                    "<h4><p>Start Time: " + reply[item].start_time + "<br> End Time: " + reply[item].end_time + "</p> </h4>" +
                                    "<span> " + reply[item].description + "</span>" +
                                    "<a href=\"#\" title=\"\" data-url=\"{% url 'groups:create' %}\" class=\"add-butn add-friend\" data-ripple=\"\">Join Service</a>"
                                    + "</div> </div> </li>";

                            }

                        }).catch(function (error) {
                        // handle error
                        alert(error);
                        console.log(error);
                    })
                }
                else if (cat_selected == "shopping")
                {
                    instance.get('/api/shoppingservice', {
                        params: {
                            gids: gid_string,
                            start: start,
                            end: end
                        }
                    }).then(
                        function (response) {
                            reply = response.data;
                            console.log(reply);

                            for (item in reply)
                            {
                                {#here, reply[item] is our service object, can access fields directly,#}
                                select.innerHTML += "<li> <div class=\'nearly-pepls\'> <div class=\"pepl-info\">" +
                                    "<h4><a href=\"#\" title=\"\">Shopping Service</a></h4>" +
                                    "<a href=\"#\" title=\"\"><h5>" + reply[item].vendor + "</h5></a>" +
                                    "<p> by " + reply[item].initiator + "</p>" +
                                    "<h4><p>Start Time: " + reply[item].start_time + "<br> End Time: " + reply[item].end_time + "</p> </h4>" +
                                    "<span> " + reply[item].description + "</span>" +
                                    "<a href=\"#\" title=\"\" data-url=\"{% url 'groups:create' %}\" class=\"add-butn add-friend\" data-ripple=\"\">Join Service</a>"
                                    + "</div> </div> </li>";
                            }
                        }).catch(function (error) {
                        // handle error
                        alert(error);
                        console.log(error);
                    })
                }
                else
                {
                    {#    travel#}
                    instance.get('/api/travelservice', {
                        params: {
                            gids: gid_string,
                            start: start,
                            end: end
                        }
                    }).then(
                        function (response) {
                            reply = response.data;
                            console.log(reply);

                            for (item in reply)
                            {
                                {#here, reply[item] is our service object, can access fields directly,#}
                                select.innerHTML += "<li> <div class=\'nearly-pepls\'> <div class=\"pepl-info\">" +
                                    "<h4><a href=\"#\" title=\"\">Travel Service</a></h4>" +
                                    "<a href=\"#\" title=\"\"><h5>" + "reply[item].vendor" + "</h5></a>" +
                                    "<p> by " + reply[item].initiator + "</p>" +
                                    "<h4><p>Source: " + reply[item].start_point + "<br> Destination: " + reply[item].end_point + "</p> </h4> <br>" +
                                    "<h4><p>Start Time: " + reply[item].start_time + "<br> End Time: " + reply[item].end_time + "</p> </h4>" +
                                    "<span> " + reply[item].description + "</span>" +
                                    "<a href=\"#\" title=\"\" data-url=\"{% url 'groups:create' %}\" class=\"add-butn add-friend\" data-ripple=\"\">Join Service</a>"
                                    + "</div> </div> </li>";
                            }
                        }).catch(function (error) {
                        // handle error
                        alert(error);
                        console.log(error);
                    })
                }
                {#console.log("new html");#}
                {#console.log(new_html);#}
                {#select.innerHTML = new_html;#}
            }
    </script>
{% endblock %}

{% block footer %}
    <link rel="stylesheet" type="text/css" href="{% static 'autocomplete_light/select2.css' %}" />
    <script type="text/javascript" src="{% static 'autocomplete_light/jquery.init.js' %}"></script>
    <script type="text/javascript" src="{% static 'autocomplete_light/autocomplete.init.js' %}"></script>
    <script type="text/javascript" src="{% static 'autocomplete_light/select2.js' %}"></script>
    <link rel="stylesheet" type="text/css" href="{% static 'autocomplete_light/vendor/select2/dist/css/select2.css' %}" />
    <script type="text/javascript" src="{% static 'autocomplete_light/vendor/select2/dist/js/select2.full.js' %}"></script>
    <script type="text/javascript" src="{% static 'autocomplete_light/forward.js' %}"></script>
    <!--    {{ form.media }}-->
{% endblock %}

